name: Artifacts
on: push

jobs:
  cypress-run:
    runs-on: ubuntu-22.04
    name: Artifacts
    steps:
      - uses: actions/checkout@v4
      
      - name: Install client
        run: |
          cd client
          npm install
          # This is janky but whatever
          echo "cd ../service && npm run dev" >> server.sh
          chmod +x server.sh

      - name: Install server
        run: |
          cd service
          npm install
          cp .env.sample .env

      - uses: cypress-io/github-action@v6
        with:
          working-directory: client
          wait-on: 'http://localhost:5173, http://localhost:5000'
          wait-on-timeout: 120
          browser: chrome
          start: |
            npm run dev
            bash -c server.sh

      # after the test run completes store videos and any screenshots
      - uses: actions/upload-artifact@v3
        # add the line below to store screenshots only on failures
        # if: failure()
        with:
          name: cypress-screenshots
          path: cypress/screenshots
          if-no-files-found: ignore # 'warn' or 'error' are also available, defaults to `warn`
        

      - uses: actions/upload-artifact@v3
        with:
          name: cypress-videos
          path: cypress/videos
          if-no-files-found: ignore # 'warn' or 'error' are also available, defaults to `warn`